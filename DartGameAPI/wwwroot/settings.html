<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - DartsMob</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/css/dartsmob.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Special+Elite&display=swap" rel="stylesheet">
</head>
<body class="settings-page">
    <div id="background-layer" class="background-layer"></div>
    <div id="background-overlay" class="background-overlay"></div>

    <header class="settings-header">
        <a href="/" class="back-link">‚Üê BACK</a>
        <h1 class="settings-title">SETTINGS</h1>
        <div class="header-spacer"></div>
        <!-- Tabs on right -->
        <nav class="settings-nav-inline">
            <button class="nav-tab-sm active" data-tab="calibration">üéØ CALIBRATION</button>
            <button class="nav-tab-sm" data-tab="theme">üé® THEME</button>
            <button class="nav-tab-sm" data-tab="audio">üîä AUDIO</button>
            <button class="nav-tab-sm" data-tab="logs">üìã LOGS</button>
            <button class="nav-tab-sm" data-tab="accuracy">üìä ACCURACY</button>
            <button class="nav-tab-sm" data-tab="system">üñ•Ô∏è SYSTEM</button>
        </nav>
    </header>

    <main class="settings-container">

        <!-- Calibration Tab -->
        <section id="tab-calibration" class="settings-section active">
            <!-- Section Title -->
            <div class="section-title-row">
                <h2 class="section-title">BOARD CALIBRATION</h2>
                <!-- Camera Selector Buttons - Compact -->
                <div class="camera-selector-compact">
                    <button class="cam-btn-sm active" data-cam="0" id="cam-btn-0">
                        CAM 0 <span class="cam-indicator" id="cam-ind-0">‚óè</span>
                    </button>
                    <button class="cam-btn-sm" data-cam="1" id="cam-btn-1">
                        CAM 1 <span class="cam-indicator" id="cam-ind-1">‚óè</span>
                    </button>
                    <button class="cam-btn-sm" data-cam="2" id="cam-btn-2">
                        CAM 2 <span class="cam-indicator" id="cam-ind-2">‚óè</span>
                    </button>
                </div>
                
                <!-- View toggle for calibration overlay -->
                <div class="calibration-view-toggle">
                    <button class="view-toggle-btn" data-view="overlay" id="view-overlay-btn">Overlay</button>
                    <button class="view-toggle-btn active" data-view="combined" id="view-combined-btn">Camera+Overlay</button>
                </div>
            </div>

            <!-- Large Camera Preview with Overlay Support -->
            <div class="camera-preview-full" id="calibration-preview">
                <img id="camera-base-img" class="calibration-camera-img" alt="Camera Feed" style="display: none;">
                <img id="main-camera-img" class="main-cam-img calibration-overlay-img" alt="Calibration Overlay">
                <div id="main-camera-loading" class="main-cam-loading">
                    <span>üì∑ Loading camera...</span>
                </div>
                <div id="main-camera-offline" class="main-cam-offline hidden">
                    <span>‚ùå Camera Offline</span>
                </div>
            </div>

            <!-- Camera Actions - Bottom bar -->
            <div class="camera-actions-bar">
                <span id="cam-quality-label" class="cam-quality-label">Not Calibrated</span>
                <span id="cam-focus-label" class="cam-focus-label" style="display:none; margin-left: 10px;"></span>
                <div class="cam-buttons">
                    <button id="focus-btn" class="btn btn-sm">üîç Focus</button>
                    <button id="refresh-btn" class="btn btn-sm">üîÑ Refresh</button>
                    <button id="mark20-btn" class="btn btn-sm">üéØ Mark 20</button>
                    <button id="calibrate-btn" class="btn btn-sm btn-primary">üéØ Calibrate</button>
                </div>
            </div>
        </section>

        <!-- Theme Tab -->
        <section id="tab-theme" class="settings-section">
            <div class="section-header">
                <h2>Customize Appearance</h2>
                <p class="section-desc">Personalize the look and feel of your game</p>
            </div>

            <div class="theme-card">
                <h3>App Branding</h3>
                <div class="input-group">
                    <label for="theme-app-name">App Name</label>
                    <input type="text" id="theme-app-name" class="input" value="DartsMob">
                </div>
                <div class="input-group">
                    <label for="theme-tagline">Tagline</label>
                    <input type="text" id="theme-tagline" class="input" value="The Family's Game">
                </div>
            </div>

            <div class="theme-card">
                <h3>Background Images</h3>
                <p class="hint">Tap to select/deselect backgrounds for slideshow</p>
                
                <div id="background-gallery" class="bg-gallery">
                    <!-- Loaded dynamically -->
                </div>
                
                <div class="bg-controls">
                    <label class="checkbox-label">
                        <input type="checkbox" id="slideshow-toggle" checked>
                        <span>Auto-rotate backgrounds</span>
                    </label>
                    <div class="speed-select">
                        <label for="slideshow-speed">Speed:</label>
                        <select id="slideshow-speed" class="select">
                            <option value="10000">10 sec</option>
                            <option value="30000" selected>30 sec</option>
                            <option value="60000">1 min</option>
                            <option value="300000">5 min</option>
                        </select>
                    </div>
                </div>
                
                <label class="btn btn-secondary upload-btn">
                    üìÅ Upload Custom Image
                    <input type="file" id="bg-upload" accept="image/*" hidden>
                </label>
            </div>

            <div class="theme-card">
                <h3>Overlay Darkness</h3>
                <div class="slider-group">
                    <input type="range" id="overlay-opacity" class="slider" min="0" max="100" value="70">
                    <span id="opacity-value" class="slider-value">70%</span>
                </div>
            </div>

            <div class="action-buttons">
                <button id="reset-theme-btn" class="btn btn-secondary">‚Ü©Ô∏è Reset</button>
                <button id="save-theme-btn" class="btn btn-primary">üíæ Save Theme</button>
            </div>
        </section>

        <!-- Audio Tab -->
        <section id="tab-audio" class="settings-section">
            <div class="section-header">
                <h2>Audio Settings</h2>
                <p class="section-desc">Configure dart score announcements and sound effects</p>
            </div>

            <div class="form-group">
                <label class="form-label">Score Announcements</label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="audio-mode" value="off" checked>
                        <span class="radio-label">Off</span>
                        <span class="radio-desc">No audio announcements</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="audio-mode" value="tts">
                        <span class="radio-label">Browser TTS</span>
                        <span class="radio-desc">Uses device's built-in voice (may not work on all devices)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="audio-mode" value="files">
                        <span class="radio-label">Pre-recorded Audio</span>
                        <span class="radio-desc">High quality MP3 files (recommended for Roku/TV)</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Volume</label>
                <input type="range" id="audio-volume" min="0" max="100" value="80" class="slider">
                <span id="volume-value" class="slider-value">80%</span>
            </div>

            <div class="form-group">
                <button id="test-audio-btn" class="btn btn-secondary">üîä Test Audio</button>
            </div>

            <div class="audio-files-info" style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                <h3 style="color: var(--gold); margin-bottom: 10px;">Pre-recorded Audio Setup</h3>
                <p style="color: var(--paper); font-size: 0.9rem; line-height: 1.6;">
                    Place MP3 files in <code style="background: rgba(0,0,0,0.5); padding: 2px 6px; border-radius: 4px;">/wwwroot/audio/</code>
                </p>
                <p style="color: var(--paper-muted); font-size: 0.85rem; margin-top: 10px;">
                    <strong>Required files (64 total):</strong><br>
                    ‚Ä¢ miss.mp3, bust.mp3, bullseye.mp3, double-bullseye.mp3<br>
                    ‚Ä¢ 1.mp3 through 20.mp3 (singles)<br>
                    ‚Ä¢ double-1.mp3 through double-20.mp3<br>
                    ‚Ä¢ triple-1.mp3 through triple-20.mp3
                </p>
            </div>

            <div class="action-row" style="margin-top: 20px;">
                <button id="save-audio-btn" class="btn btn-primary">üíæ Save Audio Settings</button>
            </div>
        </section>

        <!-- Logs Tab -->
        <section id="tab-logs" class="settings-section">
            <div class="section-header">
                <h2>System Logs</h2>
                <p class="section-desc">View and manage application logs</p>
            </div>

            <div class="log-controls" style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center;">
                <label style="display: flex; align-items: center; gap: 8px; color: var(--paper);">
                    <input type="checkbox" id="logging-enabled" checked style="width: 18px; height: 18px;">
                    <span>Enable Logging</span>
                </label>
                <select id="log-source-filter" class="form-select" style="width: auto;">
                    <option value="">All Sources</option>
                    <option value="DartDetect">DartDetect</option>
                    <option value="DartSensor">DartSensor</option>
                    <option value="DartGame">DartGame</option>
                    <option value="UI">UI</option>
                </select>
                <select id="log-level-filter" class="form-select" style="width: auto;">
                    <option value="">All Levels</option>
                    <option value="DEBUG">DEBUG</option>
                    <option value="INFO">INFO</option>
                    <option value="WARN">WARN</option>
                    <option value="ERROR">ERROR</option>
                </select>
                <select id="log-limit" class="form-select" style="width: auto;">
                    <option value="50">Last 50</option>
                    <option value="100" selected>Last 100</option>
                    <option value="500">Last 500</option>
                    <option value="1000">Last 1000</option>
                </select>
                <button id="refresh-logs-btn" class="btn btn-secondary">üîÑ Refresh</button>
            </div>

            <div class="log-viewer" style="background: #0a0a0a; border: 1px solid var(--gold-dark); border-radius: 8px; height: 400px; overflow-y: auto; font-family: monospace; font-size: 0.85rem; padding: 10px;">
                <div id="log-content" style="white-space: pre-wrap; color: #ccc;">Loading logs...</div>
            </div>

            <div class="log-stats" style="margin-top: 10px; color: var(--paper-muted); font-size: 0.85rem;">
                <span id="log-count">0 entries</span>
            </div>

            <div class="log-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                <button id="download-logs-btn" class="btn btn-primary">üì• Download Logs</button>
                <button id="clear-logs-btn" class="btn btn-danger" style="background: #8b0000;">üóëÔ∏è Clear All Logs</button>
            </div>
        </section>

        <!-- Accuracy Tab -->
        <section id="tab-accuracy" class="settings-section">
            <div class="section-header">
                <h2>Detection Accuracy</h2>
                <p class="section-desc">Analyze dart detection performance and corrections</p>
            </div>

            <div class="accuracy-controls" style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center;">
                <label style="display: flex; align-items: center; gap: 8px; color: var(--paper);">
                    <input type="checkbox" id="benchmark-enabled" style="width: 18px; height: 18px;">
                    <span>Enable Benchmark Logging</span>
                </label>
                <button id="refresh-accuracy-btn" class="btn btn-secondary">üîÑ Refresh</button>
                <button id="clear-benchmark-btn" class="btn btn-danger" style="background: #8b0000; margin-left: auto;">üóëÔ∏è Clear All Benchmark Data</button>
            </div>

            <div class="accuracy-summary" style="background: #1a1a1a; border: 1px solid var(--gold-dark); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                    <div class="stat-item">
                        <span style="color: var(--gold); font-size: 2rem; font-weight: bold;" id="overall-accuracy">--</span>
                        <span style="color: var(--paper-muted); display: block;">Overall Accuracy</span>
                    </div>
                    <div class="stat-item">
                        <span style="color: var(--paper); font-size: 2rem; font-weight: bold;" id="total-darts-logged">--</span>
                        <span style="color: var(--paper-muted); display: block;">Darts Logged</span>
                    </div>
                    <div class="stat-item">
                        <span style="color: #ff6b6b; font-size: 2rem; font-weight: bold;" id="total-corrections">--</span>
                        <span style="color: var(--paper-muted); display: block;">Corrections</span>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--gold); margin-bottom: 10px;">Logged Games</h3>
            <div id="games-list" style="max-height: 400px; overflow-y: auto;">
                <div class="game-item" style="background: #0a0a0a; border: 1px solid #333; border-radius: 6px; padding: 10px; margin-bottom: 8px; color: var(--paper-muted);">
                    No benchmark data yet. Enable logging and play a game.
                </div>
            </div>

            <!-- Game Details Modal -->
            <div id="game-details-modal" class="modal hidden" style="display: none;">
                <div class="modal-content" style="max-width: 900px; max-height: 80vh; overflow-y: auto;">
                    <h2 style="color: var(--gold);">Game Details</h2>
                    <div id="game-details-content">Loading...</div>
                    <button class="btn btn-secondary" onclick="document.getElementById('game-details-modal').style.display='none'">Close</button>
                </div>
            </div>
        </section>

        <!-- System Tab -->
        <section id="tab-system" class="settings-section">
            <div class="section-header">
                <h2>System Status</h2>
                <p class="section-desc">Monitor system health and access developer tools</p>
            </div>

            <div class="status-cards vertical">
                <div class="status-card wide">
                    <span class="status-label">DartGame API</span>
                    <span id="sys-game-api" class="status-value status-checking">Checking...</span>
                </div>
                <div class="status-card wide">
                    <span class="status-label">DartDetect API</span>
                    <span id="sys-detect-api" class="status-value status-checking">Checking...</span>
                </div>
                <div class="status-card wide">
                    <span class="status-label">Database</span>
                    <span id="sys-database" class="status-value status-checking">Checking...</span>
                </div>
                <div class="status-card wide">
                    <span class="status-label">SignalR Hub</span>
                    <span id="sys-signalr" class="status-value status-checking">Checking...</span>
                </div>
            </div>
            
            <div class="link-buttons">
                <a href="/architecture.html" class="btn btn-secondary" target="_blank">üìä Architecture</a>
                <a href="/swagger" class="btn btn-secondary" target="_blank">üìö API Docs</a>
            </div>
        </section>
    </main>

    <script src="/js/settings.js"></script>
</body>
</html>
